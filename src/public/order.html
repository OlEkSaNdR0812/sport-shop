<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Page</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      align-items: center;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-top: 20px;
    }
    .order-container {
      width: 80%;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .order-item div {
      flex: 1;
    }
    .quantity-controls {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .quantity-controls button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      margin: 0 5px;
    }
    .quantity-controls div {
      text-align: center;
      min-width: 20px;
    }
    .order-total {
      font-size: 1.2em;
      margin-top: 20px;
      text-align: right;
    }
    .order-submit {
      background-color: #28a745;
      color: white;
      padding: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
    }
    .toast {
      visibility: hidden;
      max-width: 50px;
      height: 50px;
      margin: auto;
      background-color: #28a745;
      color: #fff;
      text-align: center;
      border-radius: 2px;
      position: fixed;
      z-index: 1;
      left: 50%;
      bottom: 30px;
      font-size: 17px;
      white-space: nowrap;
    }
    .toast #desc {
      color: #fff;
      padding: 16px;
      font-size: 17px;
    }
    .show {
      visibility: visible !important;
      max-width: 100%;
    }

    /* Navbar styles */
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-height: 85px;
      box-sizing: border-box;
    }
        .navbar-logo {
            display: flex;
            align-items: center;
        }
        .navbar-logo img {
            height: 100px;
            margin-right: 10px;
        }
        .navbar-logo span {
            font-size: 36px;
            color: #8DC63F;
        }
        .navbar-menu {
            display: flex;
            align-items: center;
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
        .navbar-menu li {
            margin: 0 15px;
        }
        .navbar-menu a {
            text-decoration: none;
            color: #666;
            font-size: 16px;
        }
        .navbar-menu a:hover {
            color: #8DC63F;
        }
        .navbar-actions {
            display: flex;
            align-items: center;
        }
        .navbar-login {
            padding: 5px 15px;
            background-color: #8DC63F;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
            margin-right: 25px; 
        }
        .navbar-login:hover {
            background-color: #76B033;
        }
        .navbar-cart {
            position: relative;
        }
        .navbar-cart img {
            height: 30px;
            cursor: pointer;
        }
        .navbar-cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
        }

    /* Footer styles */
    footer {
      background-color: #333;
      color: white;
      text-align: center;
      padding: 20px 0;
      position: relative;
      width: 100%;
      margin-top: auto;
    }
    footer div a {
      color: white;
      text-decoration: none;
      margin: 0 10px;
    }
    footer div a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <!-- Header section -->
  <nav class="navbar">
    <div class="navbar-logo">
        <img src="image/LogoShop.png" alt="Shop logo">
        <span>Sport Shop</span>
    </div>
    <ul class="navbar-menu">
      <li><a href="HomePage.html">Головна</a></li>                  
      <li><a href="product_list.html">Магазин</a></li>
    </ul>
    <div class="navbar-actions">
        <a href="http://localhost:3001/auth/google" class="navbar-login">Login</a>
        <div class="navbar-cart">
            <img src="image/cart.png" alt="Cart">
            <div class="navbar-cart-count">0</div>
        </div>
    </div>
  </nav>

  <h1>Ваше замовлення</h1>
  <div class="order-container" id="orderContainer">
    <!-- Order items will be appended here by JavaScript -->
  </div>
  <div id="toast" class="toast"><div id="desc">Ваше замовлення підтверджено!</div></div>
  
  <!-- Footer section -->
  <footer>
    <div>        
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
    </div>
  </footer>

  <script>
    let cart = [];

window.onload = () => {
  cart = JSON.parse(localStorage.getItem('cart')) || [];
  displayOrder();
};

function displayOrder() {
  const orderContainer = document.getElementById('orderContainer');
  orderContainer.innerHTML = '';
  let total = 0;
  cart.forEach(item => {
    const orderItem = document.createElement('div');
    orderItem.className = 'order-item';

    const itemName = document.createElement('div');
    itemName.textContent = item.name;
    orderItem.appendChild(itemName);

    const quantityControls = document.createElement('div');
    quantityControls.className = 'quantity-controls';

    const decreaseButton = document.createElement('button');
    decreaseButton.textContent = '-';
    decreaseButton.onclick = () => updateQuantity(item.id, -1);
    quantityControls.appendChild(decreaseButton);

    const itemQuantity = document.createElement('div');
    itemQuantity.textContent = item.quantity;
    quantityControls.appendChild(itemQuantity);

    const increaseButton = document.createElement('button');
    increaseButton.textContent = '+';
    increaseButton.onclick = () => updateQuantity(item.id, 1);
    quantityControls.appendChild(increaseButton);

    orderItem.appendChild(quantityControls);

    const itemPrice = document.createElement('div');
    itemPrice.textContent = `₴${item.price * item.quantity}.00`;
    orderItem.appendChild(itemPrice);

    orderContainer.appendChild(orderItem);

    total += item.price * item.quantity;
  });
  const orderTotal = document.createElement('div');
  orderTotal.className = 'order-total';
  orderTotal.textContent = `Всього: ₴${total}.00`;
  orderContainer.appendChild(orderTotal);

  const orderSubmitButton = document.createElement('button');
  orderSubmitButton.className = 'order-submit';
  orderSubmitButton.textContent = 'Підтвердити замовлення';
  orderSubmitButton.onclick = submitOrder;
  orderContainer.appendChild(orderSubmitButton);
}

function updateQuantity(id, change) {
  const item = cart.find(item => item.id === id);
  if (item) {
    item.quantity += change;
    if (item.quantity < 1) {
      item.quantity = 1;
    }
    displayOrder();
    localStorage.setItem('cart', JSON.stringify(cart));
  }
}

async function submitOrder() {
  const orderData = cart.map(item => ({
    sporting_goodsId: item.id,
    quantity: item.quantity,
    status: 'pending',
    orderDate: new Date()
  }));

  try {
    const response = await fetch('http://localhost:3001/store/order', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(orderData)
    });

    if (response.ok) {
      showToast('Ваше замовлення підтверджено!');
      localStorage.removeItem('cart');
      setTimeout(() => {
        window.location.href = 'product_list.html';
      }, 2000);
    } else {
      showToast('Не вдалося підтвердити замовлення.');
    }
  } catch (error) {
    console.error('Failed to submit order', error);
    showToast('Не вдалося підтвердити замовлення.');
  }
}

function showToast(message) {
  const toast = document.getElementById("toast");
  const desc = document.getElementById("desc");
  desc.textContent = message;
  toast.className = "show";
  setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
}
  </script>
</body>
</html>
